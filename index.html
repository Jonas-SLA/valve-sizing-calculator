<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Valve Cv Calculator — Demo & Tests</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main class="container">
      <header>
        <h1>Valve Cv Calculator</h1>
        <p class="subtitle">
          ANSI/ISA-75.01.01 Sizing for Liquids
        </p>
      </header>

      <section class="panel inputs">
        <h2>Sizing Parameters</h2>
        
        <form id="calcForm" onsubmit="return false;">

          <div class="form-group-box">
            <h3>Process Conditions</h3>

            <div class="row">
              <label for="flowRate">Operating Flow</label>
              <div class="input-group">
                <input
                  id="flowRate"
                  type="number"
                  step="any"
                  min="0"
                  value="10"
                />
                <select id="flowRateUnit">
                  <option value="gpm">GPM</option>
                  <option value="m3h">m³/h</option>
                </select>
              </div>
            </div>

            <div class="row">
              <label for="inletPressure">Inlet Pressure</label>
              <div class="input-group">
                <input
                  id="inletPressure"
                  type="number"
                  step="any"
                  min="0"
                  value="100"
                />
                <select id="inletPressureUnit">
                  <option value="psig">psig</option>
                  <option value="kpa_g">kPa (gauge)</option>
                  <option value="bar_g">bar (gauge)</option>
                </select>
              </div>
            </div>

            <div class="row">
              <label for="outletPressure">Outlet Pressure</label>
              <div class="input-group">
                <input
                  id="outletPressure"
                  type="number"
                  step="any"
                  min="0"
                  value="90"
                />
                <select id="outletPressureUnit">
                  <option value="psig">psig</option>
                  <option value="kpa_g">kPa (gauge)</option>
                  <option value="bar_g">bar (gauge)</option>
                </select>
              </div>
            </div>

            <div class="row">
              <label for="pipeDiameter">Pipe Diameter</label>
              <div class="input-group">
                <input
                  id="pipeDiameter"
                  type="number"
                  step="any"
                  min="0.01"
                  value="1"
                />
                <select id="pipeDiameterUnit">
                  <option value="in">inches</option>
                  <option value="mm">mm</option>
                </select>
              </div>
            </div>

            <div class="row">
              <label for="temperature">Temperature</label>
              <div class="input-group">
                <input id="temperature" type="number" step="any" value="68" />
                <select id="temperatureUnit">
                  <option value="f">°F</option>
                  <option value="c">°C</option>
                  <option value="k">K</option>
                </select>
              </div>
            
            <div class="row">
              <label class="checkbox-label" style="display:flex; align-items:center; gap:8px; color:var(--accent); font-weight:600; cursor:pointer; font-size:13px; margin-top:8px;">
                <input type="checkbox" id="useAdvancedInputs" onchange="toggleAdvancedInputs()" />
                Specify Min/Max Operating Points?
              </label>
            </div>

            <div id="advancedInputs" class="form-group-box" style="display:none; margin-top:8px;">
              
              <h4>Minimum Conditions</h4>
              
              <div class="row">
                <label for="flowRateMin">Min Flow (Qmin)</label>
                <div class="input-group">
                  <input id="flowRateMin" type="number" step="any" placeholder="Auto (-10%)" />
                  <select id="flowRateMinUnit">
                    <option value="gpm">GPM</option>
                    <option value="m3h">m³/h</option>
                  </select>
                </div>
              </div>

              <div class="row">
                <label for="inletPressureMin">Inlet Pressure @ Min Flow</label>
                <div class="input-group">
                  <input id="inletPressureMin" type="number" step="any" placeholder="Constant" />
                  <select id="inletPressureMinUnit">
                    <option value="psig">psig</option>
                    <option value="kpa_g">kPa (gauge)</option>
                    <option value="bar_g">bar (gauge)</option>
                  </select>
                </div>
              </div>

              <div class="row">
                <label for="outletPressureMin">Outlet Pressure (P2)</label>
                <div class="input-group">
                  <input id="outletPressureMin" type="number" step="any" placeholder="Constant" />
                  <select id="outletPressureMinUnit">
                    <option value="psig">psig</option>
                    <option value="kpa_g">kPa (gauge)</option>
                    <option value="bar_g">bar (gauge)</option>
                  </select>
                </div>
              </div>

              <h4>Maximum Conditions</h4>

              <div class="row">
                <label for="flowRateMax">Max Flow (Qmax)</label>
                <div class="input-group">
                  <input id="flowRateMax" type="number" step="any" placeholder="Auto (+10%)" />
                  <select id="flowRateMaxUnit">
                    <option value="gpm">GPM</option>
                    <option value="m3h">m³/h</option>
                  </select>
                </div>
              </div>

              <div class="row">
                <label for="inletPressureMax">Inlet Pressure @ Max Flow</label>
                <div class="input-group">
                  <input id="inletPressureMax" type="number" step="any" placeholder="Constant" />
                  <select id="inletPressureMaxUnit">
                    <option value="psig">psig</option>
                    <option value="kpa_g">kPa (gauge)</option>
                    <option value="bar_g">bar (gauge)</option>
                  </select>
                </div>
              </div>

              <div class="row">
                <label for="outletPressureMax">Outlet Pressure (P2)</label>
                <div class="input-group">
                  <input id="outletPressureMax" type="number" step="any" placeholder="Constant" />
                  <select id="outletPressureMaxUnit">
                    <option value="psig">psig</option>
                    <option value="kpa_g">kPa (gauge)</option>
                    <option value="bar_g">bar (gauge)</option>
                  </select>
                </div>
              </div>
            </div>

          </div> <hr class="divider" />

          <div class="row">
            <h3>Selected Fluid</h3>
            <select id="fluidType">
              <option value="0">Water</option>
              <option value="1">Custom</option>
            </select>
          </div>

          <div class="row" id="customFluidInputs" style="display: none">
            <h3>Custom Fluid Properties</h3>
            <div class="row">
              <label for="Pc">Critical Pressure (Pc)</label>
              <div class="input-group">
                <input type="number" id="Pc" placeholder="e.g., 3200" />
                <select id="pcUnit">
                  <option value="psia">psia</option>
                  <option value="kpa_a">kPa (abs)</option>
                  <option value="bar_a">bar (abs)</option>
                </select>
              </div>
            </div>

            <div class="row">
              <label for="Pv">Vapor Pressure (Pv)</label>
              <div class="input-group">
                <input type="number" id="Pv" placeholder="e.g., 0.3" />
                <select id="pvUnit">
                  <option value="psia">psia</option>
                  <option value="kpa_a">kPa (abs)</option>
                  <option value="bar_a">bar (abs)</option>
                </select>
              </div>
            </div>

            <div class="row">
              <label for="density">Density (rho) or SG</label>
              <div class="input-group">
                <input type="number" id="density" placeholder="e.g., 1000" />
                <select id="densityUnit">
                  <option value="kgm3">kg/m³</option>
                  <option value="sg">SG</option>
                </select>
              </div>
            </div>

            <div class="row">
              <label for="viscosity">Kinematic Viscosity (v)</label>
              <div class="input-group">
                <input type="number" id="viscosity" placeholder="e.g., 1.0" />
                <select id="viscosityUnit">
                  <option value="cst">cSt</option>
                  <option value="m2s">m²/s</option>
                </select>
              </div>
            </div>
          </div>

        <hr class="divider" />

          <div class="row">
            <h3>Valve Type</h3>
            <select id="valveType">
              <option value="0">Globe (contoured plug, open)</option>
              <option value="1">Globe (contoured plug, close)</option>
              <option value="2">Butterfly</option>
              <option value="3">Ball (full)</option>
              <option value="99">Custom</option>
            </select>
          </div>

          <div id="customValveInputs" style="display:none;" class="form-group-box">
            <h3>Custom Valve Parameters</h3>
            
            <div class="row">
              <label for="customValveStyle">Valve Geometry Style</label>
              <select id="customValveStyle">
                <option value="0">Globe (contoured plug, open)</option>
                <option value="1">Globe (contoured plug, close)</option>
                <option value="2">Butterfly</option>
                <option value="3">Ball (full)</option>
              </select>
            </div>

            <div class="row">
              <label for="customValveSize">Valve Size</label>
              <div class="input-group">
                <input type="number" id="customValveSize" value="4" step="0.5" />
                <select id="customValveSizeUnit">
                  <option value="in">inches</option>
                  <option value="mm">mm</option>
                </select>
              </div>
            </div>

            <div class="row">
              <label for="customFl">FL - Valve Recovery Factor</label>
              <div class="input-group">
                <input type="number" id="customFl" value="0.90" step="0.01" min="0.1" max="1.0" />
                <select disabled style="opacity:0"><option></option></select>
              </div>
            </div>

            <div class="row">
              <label for="customFd">Fd - Valve Style Modifier</label>
              <div class="input-group">
                <input type="number" id="customFd" value="0.46" step="0.01" min="0.01" max="1.0" />
                <select disabled style="opacity:0"><option></option></select>
              </div>
          </div>

          </div> <div class="row actions">
            <button id="calculateBtn" class="btn primary">Calculate</button>
            <button id="resetBtn" class="btn" type="button">Reset</button>
          </div>
        </form>
      </section>

      <section class="panel output">
        <h2>Results</h2>
        <div id="result" class="result">
          Press <strong>Calculate Cv</strong> to start.
        </div>
        <div id="debugContainer">
          <h3>Debug Log</h3>
          <pre id="debugLogOutput"></pre>
        </div>
      </section>

      <section class="panel tests">
        <h2>Quick Tests</h2>
        <p>Use these preset cases to validate algorithm behavior.</p>
        <div class="row test-buttons">
          <button class="btn" id="test1">
            Test 1 — Low DP (Q=5 GPM, ΔP=1 psi)
          </button>
          <button class="btn" id="test2">
            Test 2 — Medium DP (Q=10 GPM, ΔP=10 psi)
          </button>
          <button class="btn" id="test3">
            Test 3 — High DP (Q=50 GPM, ΔP=100 psi)
          </button>
        </div>
        <details>
          <summary>Console-like Log</summary>
          <pre id="log" class="log"></pre>
        </details>
      </section>

      <footer>
        <small
          >Made for testing valve sizing logic. Units: GPM/psi/inches. Use in
          engineering workflows only after verification.</small
        >
      </footer>
    </main>

    <script src="valveDatabase.js"></script>
    <script src="app.js"></script>
    <script>
      function toggleAdvancedInputs() {
        const chk = document.getElementById('useAdvancedInputs');
        const div = document.getElementById('advancedInputs');
        div.style.display = chk.checked ? 'block' : 'none';
        if(chk.checked) {
          setTimeout(() => div.scrollIntoView({behavior: "smooth", block: "center"}), 100);
        }
      }
    </script>
  </body>
</html>